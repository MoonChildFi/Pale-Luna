const readline = require('readline'); // Importa o módulo readline para lidar com a entrada de linha de comando.
const { exec, execSync } = require('child_process'); // Importa exec e execSync de child_process para executar comandos externos.
const prompt = require('prompt-sync')(); // Importa prompt-sync para entrada síncrona do usuário.
const folderPath = '../Achievements';
const fs = require('fs');
const path = require('path');
// Cria uma interface readline para ler a entrada e escrever a saída no console.
const rl = readline.createInterface({
    input: process.stdin,
    output: process.stdout
});

function Opcãoinvalida() {
    console.clear()
    console.log ("===========================================================================")
    console.log("[ERROR: INVALID OPTION]")
    console.log ("===========================================================================")
    console.log("[PRESS [1] TO CONTINUE]");
    console.log ("===========================================================================")
    while (prompt("> ") !== '1') {
        // Fica em loop até o jogador pressionar 1
    }
    process.exit(90)
}

let config2 = false
let FN = false
let lang = 0
let tocando = false
const accountFilePath = '../Account/AccountInfo.txt';
const save_conquistas = '../Account/Achievementsavefile.bin'
let Login
let overwrite = "S"
let skipaccount = false
let check = false
const conquistasExistem = fs.existsSync(save_conquistas);
const count = fs.readdirSync(folderPath).filter(f => f.endsWith('.bin')).length;
const finais = fs.readdirSync(folderPath).filter(f => f.endsWith('.bin'));
const contaExiste = fs.existsSync(accountFilePath);
let ET = false

function account() {
    let contagg = false
    
    if (!skipaccount) {
        console.clear();
        console.log ("███████████████████████████████████████████████████████████████████")
        console.log ("██                                                               ██")
        console.log ("██                                                               ██")
        console.log ("██                           ██████                              ██")
        console.log ("██                         ██████████                            ██")
        console.log ("██                        ████████████                           ██")
        console.log ("██                        ████████████                           ██")
        console.log ("██                         ██████████                            ██")
        console.log ("██                           ██████                              ██")
        console.log ("██                          ████████                             ██")
        console.log ("██                      ███████████████                          ██")
        console.log ("██                      ███████████████                          ██")
        console.log ("██                                                               ██")
        console.log ("███████████████████████████████████████████████████████████████████")
        console.log ("")
        console.log ("===========================================================================")
            console.log("[DO YOU WANT TO CREATE A LOCAL ACCOUNT]");
            console.log ("===========================================================================")
            console.log ("[01] Create Account");
            console.log ("[02] Ignore");
            console.log ("===========================================================================")
            Login = Number(prompt("> "));
            
            if (Login == 1) {
                console.clear();
            skipsavefilecheck = true
            check = true
                if (contaExiste) {
                    
                    console.log ("███████████████████████████████████████████████████████████████████")
        console.log ("██                                                               ██")
        console.log ("██                           ██████                              ██")
        console.log ("██                       █████   ██████                          ██")
        console.log ("██                      ████        ██████                       ██")
        console.log ("██                                 ██████                        ██")
        console.log ("██                               ██████                          ██")
        console.log ("██                             ██████                            ██")
        console.log ("██                           ██████                              ██")
        console.log ("██                                                               ██")
        console.log ("██                           ██████                              ██")
        console.log ("██                           ██████                              ██")
        console.log ("██                                                               ██")
        console.log ("███████████████████████████████████████████████████████████████████")
        console.log ("")
                    console.log ("===========================================================================")
                    console.log("[THERE IS A SAVE FILE, DO YOU WISH TO OVERWRITE IT]");
                    console.log ("===========================================================================")
                    console.log ("[Y] Yes");
                    console.log ("[N] No");
                    overwrite = prompt("> ").toUpperCase();
            
    
                    if (overwrite !== 'Y') {
                        console.clear();
                        console.log ("███████████████████████████████████████████████████████████████████")
        console.log ("██                                                               ██")
        console.log ("██                           ██████                              ██")
        console.log ("██                           ██████                              ██")
        console.log ("██                           ██████                              ██")
        console.log ("██                           ██████                              ██")
        console.log ("██                           ██████                              ██")
        console.log ("██                           ██████                              ██")
        console.log ("██                           ██████                              ██")
        console.log ("██                                                               ██")
        console.log ("██                           ██████                              ██")
        console.log ("██                           ██████                              ██")
        console.log ("██                                                               ██")
        console.log ("███████████████████████████████████████████████████████████████████")
        console.log ("")
                        console.log ("===========================================================================")
                        console.log("[ACCOUNT CREATION SKIPPED]");
    
                    }
                }
                if (overwrite == "Y") {
                    console.clear()
                    console.log ("███████████████████████████████████████████████████████████████████")
        console.log ("██                                                               ██")
        console.log ("██                                                               ██")
        console.log ("██                           ██████                              ██")
        console.log ("██                         ██████████                            ██")
        console.log ("██                        ████████████                           ██")
        console.log ("██                        ████████████                           ██")
        console.log ("██                         ██████████                            ██")
        console.log ("██                           ██████                              ██")
        console.log ("██                          ████████                             ██")
        console.log ("██                      ███████████████                          ██")
        console.log ("██                      ███████████████                          ██")
        console.log ("██                                                               ██")
        console.log ("███████████████████████████████████████████████████████████████████")
        console.log ("")
                console.log ("===========================================================================")
                Usuario = prompt("[USERNAME]: ");
                Senha = prompt("[PASSWORD]: ");
                console.log ("===========================================================================")
            
                const conteudo =
                                 "[USERNAME]: " + Usuario + "\r\n" +
                                 "[PASSWORD]: " + Senha + "\r\n" + 
                                 "[LANGUAGE]: English (US) \r\n";
            
                fs.writeFileSync(accountFilePath, conteudo, 'utf8');
        
                let finais1
        if (count == 0) {
            console.clear();
            console.log ("===========================================================================")
            console.log ("[SYSTEM]: Account created successfully!");
            console.log ("===========================================================================")
            console.log("-> You can access your information in the file ")
            console.log("'Accountinfo.txt' in the 'Account' folder.");
            console.log ("===========================================================================")
            console.log("-> You have no endings, when you get them they will be located in: ")
            console.log("'Achievementsavefile.bin' in the 'Account' folder.");
        
        } else {
            finais1 = finais
            const conteudo5 = 
                
                                 (finais1) + "\r\n"; 
        
        fs.writeFileSync(save_conquistas, conteudo5, 'utf8');      
        contagg = true     
        }  
            }
            if (contagg){
            console.clear();
            console.log ("===========================================================================")
            console.log ("[SYSTEM]: Account created successfully!");
            console.log ("===========================================================================")
            console.log("-> You can access your information in the file ")
            console.log("'Accountinfo.txt' in the 'Account' folder.");
            console.log ("===========================================================================")
            console.log("-> Your endings are saved in the file ")
            console.log("'Achievementsavefile.bin' in the 'Account' folder.");
            }
    
            } else {
                console.clear();
                console.log ("===========================================================================")
                console.log("[ACCOUNT CREATION SKIPPED]");
            }
            }
    
        pausarParaContinuar()
    
}


function printDivider() {
    console.log("---------------------------------------------------------------");
}


// Define os itens do menu principal em português.
const menuItems = [
    'START GAME',
    'RESET PROGRESS',
    'ACHIEVEMENTS',
    'SETTINGS',
    'EXIT'
];

let selectedIndex = 0; // Mantém o controle do item de menu atualmente selecionado (índice).

function tocamusic() {
    const command = `start /min "" "./audios/VLC/vlc.exe" --play-and-exit --qt-start-minimized "./audios/You_Cant_Escape.mp3"`;
//lembrar q o ¨¨  é o titulo do cmd
    exec(`cmd.exe /c "${command}"`, (error, stdout, stderr) => {
        // azio para suumir quaisquer mensagens no console.
    });
}

function askForMusicPreference() {
if (tocando) {
    console.clear()
    console.log ("===========================================================================")
console.log ("[MUSIC IS STILL PLAYING]")
console.log ("===========================================================================")
    console.log("-> Do you want to stop it?");
console.log ("===========================================================================")
    console.log("[01] Yes");
    console.log("[02] No");
console.log ("===========================================================================")
let msuica = Number(prompt("> "));

if (msuica == 1) {
    console.clear()
console.log ("===========================================================================")
    console.log("[MUSIC STOPPED]");

    exec('taskkill /IM vlc.exe /F', (error, stdout, stderr) => {
        if (error) {
            console.error(`Erro ao tentar parar a música: ${error.message}`);
            return;
        }
        tocamusic = false; // Atualiza o estado para indicar que a música não está mais tocando.
    });
    pausarParaContinuar()
    tocando = false
}
} else {
         console.clear();
    console.log ("===========================================================================")
        console.log("[ACTIVATE SOUNDTRACK]");
        console.log ("===========================================================================")
        console.log("[01] Yes");
        console.log("[02] No");
        console.log ("===========================================================================")
    
        let musicChoice = Number(prompt("> "));
        if (musicChoice === 1) {
            console.clear()
            console.log ("===========================================================================")
            console.log ("[SOUNDTRACK STARTED]")
            console.log ("===========================================================================")
            tocamusic()
            tocando = true
            pausarParaContinuar()
        } else if (musicChoice != 1 && musicChoice != 2){
            Opcãoinvalida()
        }

}

}


function Idioma() {
    console.clear();
    console.log ("===========================================================================")
    console.log ("[LANGUAGE SELECTION]")
    console.log ("===========================================================================")
    console.log("[01] Português");
    console.log("[02] English");
    console.log ("===========================================================================")

    lang = Number(prompt("> "));
    if (lang == 1) {
        portugues = true;
        english = false;
    } else if (lang == 2) {
        portugues = false;
        english = true;
    } else {
        console.clear();
        console.log ("===========================================================================")
        console.log("[ERROR 444] INVALID LANGUAGE");
        console.log ("===========================================================================")
        console.log("[CLOSING...]");
        console.log ("===========================================================================")
        process.exit();
    }
}

let config = true
function ajustarCores() {
    let config = true
    while (config) {
        console.clear()
        config2 = true
console.log ("===========================================================================")
console.log ("[SETTINGS]")
console.log ("===========================================================================")
console.log ("[01] - Language Selection")
console.log ("[02] - Soundtrack")
console.log ("[03] - Account Creation")
console.log ("[04] - Restore Endings")
console.log ("[05] - Include Easter Eggs")
console.log ("[06] - Return to menu")
console.log ("===========================================================================")
let escolha = Number(prompt("> "));

if (escolha == 1) {
Idioma()
} else if (escolha == 2) {
    console.log ("a")
    askForMusicPreference()
} else if (escolha == 3) {
account()
} else if (escolha == 4) {

    const local_conta = save_conquistas;
    const count1 = fs.existsSync(local_conta)
    check = false
    while (check == false) {
    
if (FN) {
    console.clear()
    console.log ("===========================================================================")
    console.log ("[ENDINGS RESTORATION ALREADY DONE]")
    
    check = true
    pausarParaContinuar()
}

    if (!count1) {
        console.log ("===========================================================================")
    console.log ("[ENDINGS FILE NOT FOUND]")
    check = true
    pausarParaContinuar()
    }
    if (count1 && !FN) {
        console.clear()
    console.log ("===========================================================================")
    console.log("[ENDINGS DETECTED]")
    console.log ("===========================================================================")
    console.log ("[DO YOU WANT TO RESTORE]")
    console.log ("===========================================================================")
    console.log ("-> [01] Yes")
    console.log ("-> [02] No")
    console.log ("-> [03] Check Folder")
    console.log ("===========================================================================")
    let restart = Number(prompt("> "))
    
    if (restart == 1){
    try {
    const dados = fs.readFileSync(save_conquistas, 'utf8')
    console.clear()
    console.log ("===========================================================================")
    console.log ("[ENDINGS THAT WILL BE RESTORED]")
    console.log ("===========================================================================")
    FN = true
    console.log([dados])
    } catch (err) {
    console.error('[ERROR]: Failed to read files!')
    
    }
    pausarParaContinuar()
    FN = true
    
    dados = fs.readFileSync(save_conquistas, 'utf8')
    if (dados.includes('BAD_ENDING.bin')) {
        fs.writeFileSync('../Achievements/BAD_ENDING.bin', 'a', 'utf8');
        FN = true
    }
    if (dados.includes('REAL_ENDING.bin')) {
        fs.writeFileSync('../Achievements/REAL_ENDING.bin', 'a', 'utf8');
FN = true
    }
    if (dados.includes('GOOD_ENDING.bin')) {
        fs.writeFileSync('../Achievements/GOOD_ENDING.bin', 'a', 'utf8');
FN = true
    }
    if (dados.includes('BAD_ENDING2.bin')) {
        fs.writeFileSync('../Achievements/BAD_ENDING2.bin', 'a', 'utf8');
        FN = true
    }
    if (dados.includes('BAD_ENDING3.bin')) {
        fs.writeFileSync('../Achievements/BAD_ENDING3.bin', 'a', 'utf8');
        FN = true
    }
    if (dados.includes('SECRET_ENDING.bin')) {
        fs.writeFileSync('../Achievements/SECRET_ENDING.bin', 'a', 'utf8');
        FN = true
    }
    if (dados.includes('undefined')) {
        console.clear()
        console.log ("===========================================================================")
    console.log("[NO ENDINGS DETECTED]")
    pauseToContinue()
    }
    
    check = true
    
    } else if (restart == 2){
        check = true
        console.clear()
        console.log ("===========================================================================")
        console.log  ("[RESTORATION CANCELED]")
        pausarParaContinuar()
    } else if (restart == 3){
        console.clear()
        console.log ("===========================================================================")
        console.log  ("[CHECKING FOLDERS]")
        console.log ("===========================================================================")
    
        if (finais != null) {
            console.log ("[FILES FOUND]")
            console.log (finais)
            console.log ("===========================================================================")
            console.log ("-> If you want to keep these endings, DO NOT RESTORE")
            pausarParaContinuar()
        } else {
            console.log ("===========================================================================")
            console.log ("[YOU HAVE NO SAVED ENDINGS]")
            pausarParaContinuar()
        }
    } else {
        Opcãoinvalida()
    }
    }
    
    }
}else if (escolha == 5) {
    console.clear()
    console.log ("===========================================================================")
    console.log ("[EASTER EGGS]")
    console.log ("===========================================================================")
    console.log ("[01] - Activate Easter Eggs")
    console.log ("[02] - Disable Easter Eggs")
    console.log ("[03] - Return to the settings menu")
    console.log ("===========================================================================")
    let easterEggsChoice = Number(prompt("> "));
    if (easterEggsChoice == 1) {
        console.clear()
        console.log ("===========================================================================")
        console.log ("[EASTER EGGS]")
        console.log ("===========================================================================")
        console.log ("-> Easter Eggs Activated!")
        console.log ("-> Easter Eggs Enabled!")
        ET = true   
        pauseToContinue()
    } else if (easterEggsChoice == 2) {
        console.clear()
        console.log ("===========================================================================")
        console.log ("[EASTER EGGS]")
        console.log ("===========================================================================")
        console.log ("-> Easter Eggs Disabled!")
        console.log ("-> Easter Eggs Disabled!")
        ET = false
        pauseToContinue()
    } else if (easterEggsChoice == 3) {
        console.clear()
    } else {
        console.clear()
        console.log ("===========================================================================")
        console.log ("[EASTER EGGS]")
        InvalidOption()
    }
} else if (escolha == 6) {
config = false
desenharMenu(); // Redesenha o menu principal após sair das configurações de cor.
    process.stdin.setRawMode(true); // Retoma o modo bruto para a detecção de teclas.
    process.stdin.resume(); // Retoma a entrada padrão.
} else {

}



    }
}

// Objeto que mapeia códigos de cores (hex e numéricos) para nomes de cores e vice-versa.
const cores = {
    "0": "Black", "1": "Dark Blue", "2": "Dark Green", "3": "Dark Cyan",
    "4": "Dark Red", "5": "Dark Purple", "6": "Yellow (Olive)", "7": "White (Light Gray)",
    "8": "Dark Gray", "9": "Light Blue", "A": "Light Green", "B": "Light Cyan",
    "C": "Light Red", "D": "Light Purple (Light Magenta)", "E": "Light Yellow", "F": "Bright White",
    "Black": "0", "Dark Blue": "1", "Dark Green": "2", "Dark Cyan": "3", "Dark Red": "4", "Dark Purple": "5",
    "Yellow": "6", "White": "7", "Dark Gray": "8", "Light Blue": "9", "Light Green": "A",
    "Light Cyan": "B", "Light Red": "C", "Light Purple": "D", "Light Yellow": "E",
    "Bright White": "F"
};

// Define várias constantes de texto usadas para exibir mensagens e títulos.

const linhaDivisoria = "---------------------------------------------------------------------------";
const tituloConfigs = "SETTINGS";
const tituloCorTerminal = "// TERMINAL COLOR \\\\";
const tituloFundo = "*Set a background color:";
const tituloTexto = "*Set a text color:";

// Listas de cores de fundo e texto com seus códigos correspondentes.
const listaFundo = [
    "0 = Black", "1 = Dark Blue", "2 = Dark Green", "3 = Dark Cyan", "4 = Dark Red", "5 = Dark Purple",
    "6 = Yellow", "7 = White", "8 = Dark Gray", "9 = Light Blue"
];

const listaTexto = [
    "A = Light Green", "B = Light Cyan", "C = Light Red",
    "D = Light Purple", "E = Light Yellow", "F = Bright White"
];

// Função para normalizar a entrada de cor (por exemplo, "preto" para "Preto" ou "0" para "0").
function arrumarEntradaCor(entrada) {
    if (!entrada) return '';
    entrada = entrada.trim();
    if (entrada.length === 1 && cores[entrada.toUpperCase()]) {
        return entrada.toUpperCase();
    }
    return entrada.split(' ').map(palavra => palavra.charAt(0).toUpperCase() + palavra.slice(1).toLowerCase()).join(' ');
}

// Função para desenhar o menu principal no console.
function desenharMenu() {
    console.clear(); // Limpa a tela do console.
    // Logo em arte ASCII.
    console.log ("██████╗  █████╗ ██╗     ███████╗ TM           ███████████");
    console.log ("██╔══██╗██╔══██╗██║     ██╔════╝           █████████████████ ");
    console.log ("██████╔╝███████║██║     █████╗           █████████████████████ ");
    console.log ("██╔═══╝ ██╔══██║██║     ██╔══╝          ███████████████████████ ");
    console.log ("██║     ██║  ██║███████╗███████╗      ███████████████████████████");
    console.log ("╚═╝     ╚═╝  ╚═╝╚══════╝╚══════╝      ███████████████████████████");
    console.log ("██╗     ██╗   ██╗███╗   ██╗ █████╗    ███████████████████████████");
    console.log ("██║     ██║   ██║████╗  ██║██╔══██╗   ███████████████████████████");
    console.log ("██║     ██║   ██║██╔██╗ ██║███████║     ███████████████████████");
    console.log ("██║     ██║   ██║██║╚██╗██║██╔══██║      █████████████████████ ");
    console.log ("███████╗╚██████╔╝██║ ╚████║██║  ██║        █████████████████");
    console.log ("╚══════╝ ╚═════╝ ╚═╝  ╚═══╝╚═╝  ╚═╝           ███████████ ");
    console.log ("===========================================================================")
    console.log ("--- TERMINAL EDITION - MADE BY SAD BERRY GAMES ---")
    console.log ("===========================================================================")

    // Itera sobre os itens do menu e exibe o selecionado com "> <".
    menuItems.forEach((item, index) => {
        if (index === selectedIndex) {
            console.log(`\x1b[91m[> ${item} <] \x1b[96m`);
        } else {
            console.log(`  ${item}`);
        }
    });
    console.log('\nUse the up/down arrows to navigate, Enter to select.');
}

function pausarParaContinuar() {
    console.log ("===========================================================================")
    console.log("[PRESS [1] TO CONTINUE]");
    console.log ("===========================================================================")
    while (prompt("> ") !== '1') {
        // Fica em loop até o jogador pressionar 1
    }
    console.clear();
}
function conquistas() {
    const count = fs.readdirSync(folderPath).filter(f => f.endsWith('.bin')).length;
    const finais = fs.readdirSync(folderPath).filter(f => f.endsWith('.bin'));
    console.clear()
        console.log ("===========================================================================")
            console.log("[CHECKING FOLDER]")

    if (count > 0) {
                console.log ("===========================================================================")
            console.log("[FILES FOUND]")
                console.log(finais)
                console.log ("===========================================================================")
                console.log("-> If you want to keep these endings, DO NOT RESTORE")
            pausarParaContinuar()
    } else {
            console.log ("===========================================================================")
                console.log("-> No ending files found!")
            pausarParaContinuar()
    }

     desenharMenu(); // Redraws the main menu after exiting color settings.
    process.stdin.setRawMode(true); // Resumes raw mode for keypress detection.
    process.stdin.resume(); // Resumes stdin.
}

// Função para lidar com os ajustes de cor do terminal.
function ajustarCores1() {
    let toNessaTelaDeCor = true; // Flag para continuar o loop na tela de configurações de cor.

    while (toNessaTelaDeCor) {
        console.clear();
        console.log(linhaDivisoria);
        console.log(tituloConfigs);
        console.log(linhaDivisoria);
        console.log(tituloCorTerminal);
        console.log("");
        console.log(tituloFundo);
        listaFundo.forEach(item => console.log(item)); // Exibe as cores de fundo disponíveis.
        console.log("");
        console.log(tituloTexto);
        listaTexto.forEach(item => console.log(item)); // Exibe as cores de texto disponíveis.
        console.log("");
        console.log(linhaDivisoria);
        console.log("-> To return to the Main Menu, simply press ENTER for both options.");
        console.log("-> You can change the colors many times here!");
        console.log(linhaDivisoria);

        let inputFundo = prompt("Background color (enter the name, ex: Black): ");
        let inputTexto = prompt("Text color (enter the name, ex: Light Green): ");

        // Verifica se o usuário quer voltar ao menu principal.
        if (inputFundo.trim() === '0' || (inputFundo.trim() === '' && inputTexto.trim() === '')) {
            toNessaTelaDeCor = false;
            console.clear();
            console.log("Returning to the Main Menu...");
            break;
        }

        // Obtém os códigos das cores a partir da entrada do usuário.
        const codigoDoFundo = cores[arrumarEntradaCor(inputFundo)];
        const codigoDoTexto = cores[arrumarEntradaCor(inputTexto)];
        
        // Validação da entrada de cores.
        if (!codigoDoFundo || !codigoDoTexto) {
            console.clear();
            console.log(linhaDivisoria);
            console.log("-> Error: One or both colors entered are incorrect!");
            console.log("-> Please, type the names or codes (0-F) exactly as they appear in the list.");
            console.log(linhaDivisoria);
            prompt("Press ENTER to try again...");
        } else if (codigoDoFundo === codigoDoTexto) { // Verifica se as cores de fundo e texto são as mesmas.
            console.clear();
            console.log(linhaDivisoria);
            console.log("-> Error: The background and text colors cannot be the same! You won't be able to read anything!");
            console.log("-> Please, choose different colors for the background and text.");
            console.log(linhaDivisoria);
            prompt("Press ENTER to try again...");
        } else {
            // Constrói o comando para mudar as cores do terminal.
            const comandoCor = `COLOR ${codigoDoFundo}${codigoDoTexto}`;
            try {
                execSync(comandoCor, { stdio: 'inherit' }); // Executa o comando de forma síncrona.

                console.clear();
                console.log(linhaDivisoria);
                console.log("-> TERMINAL COLORS CHANGED SUCCESSFULLY!");
                console.log(linhaDivisoria);
                // Exibe as cores escolhidas.
                console.log(`Background: ${listaFundo.find(item => item.startsWith(codigoDoFundo)) || codigoDoFundo}`);
                console.log(`Text: ${listaTexto.find(item => item.startsWith(codigoDoTexto)) || codigoDoTexto}`);
                console.log(linhaDivisoria);
                console.log("-> Your terminal colors are now different!");
                prompt("Press ENTER to set more colors or go back...");
            } catch (error) {
                // Tratamento de erro se a alteração das cores falhar (por exemplo, não está no Windows).
                console.clear();
                console.log(linhaDivisoria);
                console.log("-> FAILED to change colors.");
                console.log("-> Make sure you are running this in a Windows terminal (CMD or PowerShell).");
                console.log(`Technical Error: ${error.message}`);
                console.log(linhaDivisoria);
                prompt("Press ENTER to try again...");
            }
        }
    }
    desenharMenu(); // Redesenha o menu principal após sair das configurações de cor.
    process.stdin.setRawMode(true); // Retoma o modo bruto para a detecção de teclas.
    process.stdin.resume(); // Retoma a entrada padrão.
}

desenharMenu(); // Desenha o menu inicial.

process.stdin.setRawMode(true); // Define a entrada padrão para o modo bruto para capturar o pressionamento de teclas individuais.
process.stdin.resume(); // Retoma a entrada padrão, permitindo que ela emita eventos 'data'.

// Listener de eventos para dados de entrada (pressionamento de teclas).
process.stdin.on('data', (chunk) => {
    const key = chunk.toString('hex'); // Converte o buffer da tecla para uma string hexadecimal.

    switch (key) {
        case '1b5b41': // Tecla de seta para cima
            selectedIndex = (selectedIndex - 1 + menuItems.length) % menuItems.length; // Move a seleção para cima, com loop.
            desenharMenu();
            break;
        case '1b5b42': // Tecla de seta para baixo
            selectedIndex = (selectedIndex + 1) % menuItems.length; // Move a seleção para baixo, com loop.
            desenharMenu();
            break;
        case '0d': // Tecla Enter
            console.clear();
            
            if (selectedIndex === 0) { // Opção "Iniciar Jogo"
                rl.close(); // Fecha a interface readline.
                process.stdin.pause(); // Pausa a entrada padrão.
if (ET) {
    fs.writeFileSync('../assets/ET.txt', 'Easter Eggs Ativados', 'utf8'); // Cria um arquivo para ativar Easter Eggs.
} console.clear()
let a11111 = fs.existsSync('../account/AccountInfo.txt')
if (config2 == false) {
    console.log ("===========================================================================")
    console.log ("[RECOMMENDATION]")
    console.log ("===========================================================================")
    console.log ("-> You have not accessed the settings menu yet, if you are interested in these topics:")
    console.log ("===========================================================================")
    console.log ("[SOUNDTRACK]")
    console.log ("[ACCOUNT CREATION]")
    console.log ("[SAVE RESTORATION]")
    console.log ("[EASTER EGGS]")
    console.log ("===========================================================================")
    console.log ("-> Access the settings menu by following these steps:")
    console.log ("-> MENU > SETTINGS")
    pausarParaContinuar()


}

if (!a11111) {
    console.log ("===========================================================================")
    console.log ("[WARNING - ACCOUNT CREATION]")
    console.log ("===========================================================================")
    console.log ("-> You have not created an account, if you wish to create one. Follow the steps below!")
    console.log ("-> MENU > SETTINGS > ACCOUNT CREATION")
    pausarParaContinuar()
}
                require('./mainEN.js'); // Requer um script externo para iniciar o jogo.
            } else if (selectedIndex === 4) { // Opção "Sair"
                rl.close();
                process.exit(); // Sai do processo Node.js.
            } else if (selectedIndex === 1) { // Opção "Excluir progresso"
                process.stdin.setRawMode(false); // Desativa o modo bruto antes de executar o comando externo.
                process.stdin.pause(); // Pausa a entrada padrão.
                exec('start cmd.exe /c Erase_Data.bat', (error) => { // Executa o arquivo batch em uma nova janela.
                    if (error) {
                        console.error(`Erro ao executar o arquivo: ${error.message}`);
                    } else {
                        console.log('The Erase_Data.bat command was executed successfully.');
                    }
                    console.log('\nPress ENTER to return to the menu...');
                    prompt(''); // Espera o usuário pressionar Enter.
                    desenharMenu(); // Redesenha o menu.
                    process.stdin.setRawMode(true); // Reabilita o modo bruto.
                    process.stdin.resume(); // Retoma a entrada padrão.
                });
            } else if (selectedIndex === 2) { // Opção "Ver Conquistas"
                process.stdin.setRawMode(false);
                process.stdin.pause();
                conquistas();
            } else if (selectedIndex === 3) { // Opção "Mudar para Inglês"
                process.stdin.setRawMode(false);
                process.stdin.pause();
                
                ajustarCores();
                
            }
            break;
        case '03': // Ctrl+C (SIGINT)
            
            rl.close();
            process.exit();
            break;
        default: // Lida com qualquer outro pressionamento de tecla (não faz nada).
            break;
    }
});

// Listener de eventos para quando a interface readline é fechada.
rl.on('close', () => {
    console.log('\nMenu closed.');
});